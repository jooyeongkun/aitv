INFO:     Started server process [2973]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:5002 (Press CTRL+C to quit)
Raw message received: ' 안녕'
Processed message:  안녕
Processing message:  안녕 (conversation: 17)
Determined intent: general
Keywords: ['안녕']
Found hotels: 0, tours: 0
Self-Validation Score: 38.3 (POOR)
Issues found: 검색 결과가 없는데 적절한 안내가 없음
INFO:     14.225.71.149:58650 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '패밀리팩 3명 얼마?'
Processed message: 패밀리팩 3명 얼마?
Processing message: 패밀리팩 3명 얼마? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['패밀리팩', '패밀리', 'family', '가족', '얼마', '가격', '비용', '요금']
New tour type detected: 패밀리. Clearing previous context.
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 패밀리팩 3명 얼마?, Keywords found: []
=== PROMPT DEBUG ===
User message: 패밀리팩 3명 얼마?
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 869
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "패밀리팩 3명 얼마?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


이전 대화:
**이전 대화 (반드시 참고하세요):**
1. 고객:  안녕
   상담사: 네, 안녕하세요! 어떤 도움이 필요하신가요?

**직전 대화 (가장 중요):**
고객:  안녕
상담사: 네, 안녕하세요! 어떤 도움이 필요하신가요?


사용자 질문: 패밀리팩 3명 얼마?

투어 정보:
🚌 **패밀리팩** (다낭)
📅 **3일**
📝 관련정보: 가격 인당 기준
2인: 12만원 + $932
3인: 18만원 + $1,092
4인: 24만원 + $1,242
5인: 30만원+ $...
=== END DEBUG ===
AI Response generated: 패밀리팩 3명의 가격은 총 18만원 + $1,092입니다. 추가로 아동이 있으신 경우, 키에 따라 가격이 달라질 수 있습니다. 아동의 키에 대한 정보가 필요합니다....
Updated context with tour type: 패밀리
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:58484 - "POST /chat HTTP/1.1" 200 OK
Traceback (most recent call last):
  File "/root/aitv/ai-service/main.py", line 61, in chat_endpoint
    result = travel_ai.process_message(message, request.conversation_id)
  File "/root/aitv/ai-service/ai_service.py", line 1467, in process_message
    if is_children_question:
NameError: name 'is_children_question' is not defined
Raw message received: '아이는 얼마지?'
Processed message: 아이는 얼마지?
Processing message: 아이는 얼마지? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['얼마', '가격', '비용', '요금', '아이', '아이는', '얼마지']
Using previous search results for price inquiry
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 아이는 얼마지?, Keywords found: []
=== PROMPT DEBUG ===
User message: 아이는 얼마지?
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1310
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "아이는 얼마지?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 패밀리팩 3명 얼마?

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '패밀리' 투어(패밀리팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "아이는 얼마지?"는 100% '패밀리' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어의 아동 1인 가격은 키 100cm 이상 ~ 140cm 미만일 경우 예약금 3만원과 현장결제 $165입니다. 만약 아동의 키가 140cm 이상이라면 성인 요금이 적용됩...
Updated context with tour type: 패밀리
Response was modified to remove forbidden content
ERROR: name 'is_children_question' is not defined
INFO:     14.225.71.149:45090 - "POST /chat HTTP/1.1" 500 Internal Server Error
Raw message received: '반가워'
Processed message: 반가워
Processing message: 반가워 (conversation: 17)
Determined intent: general
Keywords: ['반가워']
Using stored tour type from context: 패밀리
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 반가워, Keywords found: []
=== PROMPT DEBUG ===
User message: 반가워
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1543
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 반가워요! 패밀리팩 투어에 대해 계속 이야기해볼까요?

아동 가격에 대한 정보는 다음과 같습니다:
- 24개월 미만: 무료
- 키 100cm 이상 ~ 140cm 미만: 예약금 3만...
Updated context with tour type: 패밀리
Self-Validation Score: 51.7 (POOR)
INFO:     14.225.71.149:35468 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '패밀리팩 3명 얼마?'
Processed message: 패밀리팩 3명 얼마?
Processing message: 패밀리팩 3명 얼마? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['패밀리팩', '패밀리', 'family', '가족', '얼마', '가격', '비용', '요금']
New tour type detected: 패밀리. Clearing previous context.
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ce323ee9...
Updated context with tour type: 패밀리
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:33830 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '안녕'
Processed message: 안녕
Processing message: 안녕 (conversation: 17)
Using cached tour results for: 
Determined intent: general
Keywords: ['안녕']
Using stored tour type from context: 패밀리
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Updated context with tour type: 패밀리
Self-Validation Score: 41.7 (POOR)
Issues found: 검색 결과가 있지만 응답에 반영되지 않음
INFO:     14.225.71.149:53684 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '베스트팩 얼마?'
Processed message: 베스트팩 얼마?
Processing message: 베스트팩 얼마? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['베스트팩', '베스트', 'best', '베스트투어', '얼마', '가격', '비용', '요금']
New tour type detected: 베스트. Clearing previous context.
Filtered tours by type '베스트': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 베스트팩 얼마?, Keywords found: []
=== PROMPT DEBUG ===
User message: 베스트팩 얼마?
Tours found: 1
Tour names: ['베스트팩']
Prompt length: 1165
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "베스트팩 얼마?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 안녕

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '패밀리' 투어(베스트팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "베스트팩 얼마?"는 100% '패밀리' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른 모든 투어 정보...
=== END DEBUG ===
AI Response generated: 베스트팩 투어 2명 가격은 예약금 12만원 + 잔금 $935입니다. 총액은 12만원 + $935입니다. 

아동이 있으신 경우 아동 1인 기준 가격도 안내해드릴 수 있습니다. 아동...
Updated context with tour type: 베스트
Warning: Removing forbidden phrase '1인 기준' from response
Response was modified to remove forbidden content
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:53692 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '아동가격은 얼마? 140cm'
Processed message: 아동가격은 얼마? 140cm
Processing message: 아동가격은 얼마? 140cm (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['가격', '비용', '요금', '얼마', '아동', '아동가격은', 'cm']
Using previous search results for price inquiry
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 아동가격은 얼마? 140cm, Keywords found: []
=== PROMPT DEBUG ===
User message: 아동가격은 얼마? 140cm
Tours found: 1
Tour names: ['베스트팩']
Prompt length: 1192
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "아동가격은 얼마? 140cm"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 베스트팩 얼마?

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '베스트' 투어(베스트팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "아동가격은 얼마? 140cm"는 100% '베스트' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 ...
=== END DEBUG ===
AI Response generated: 베스트팩 투어의 아동 1인 가격은 키 100cm 이상 ~ 140cm 미만일 경우 예약금 3만원 + 잔금 $170입니다. 

키가 140cm 이상이라면 성인 요금이 적용됩니다. 추가...
Updated context with tour type: 베스트
Response was modified to remove forbidden content
Self-Validation Score: 68.3 (WARNING)
INFO:     14.225.71.149:42226 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '140cm면 성인 가격이야?'
Processed message: 140cm면 성인 가격이야?
Processing message: 140cm면 성인 가격이야? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['가격', '비용', '요금', '얼마', '성인', '가격이야', 'cm']
Using previous search results for price inquiry
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 140cm면 성인 가격이야?, Keywords found: []
=== PROMPT DEBUG ===
User message: 140cm면 성인 가격이야?
Tours found: 1
Tour names: ['베스트팩']
Prompt length: 1199
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "140cm면 성인 가격이야?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 아동가격은 얼마? 140cm

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '베스트' 투어(베스트팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "140cm면 성인 가격이야?"는 100% '베스트' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, ...
=== END DEBUG ===
AI Response generated: 베스트팩 투어에 대해 문의하신 것이라면, 140cm 이상의 키를 가진 경우 성인 요금이 적용됩니다. 성인 1명의 가격은 예약금 12만원 + 잔금 $935입니다. 추가로 아동이 있는...
Updated context with tour type: 베스트
Self-Validation Score: 68.3 (WARNING)
INFO:     14.225.71.149:39740 - "POST /chat HTTP/1.1" 200 OK
INFO:     45.177.179.227:40816 - "CONNECT www.google.com%3A443 HTTP/1.1" 404 Not Found
Raw message received: '안녕'
Processed message: 안녕
Processing message: 안녕 (conversation: 17)
Determined intent: general
Keywords: ['안녕']
Using stored tour type from context: 베스트
Filtered tours by type '베스트': 1 tours found
Found hotels: 0, tours: 1
Updated context with tour type: 베스트
Self-Validation Score: 41.7 (POOR)
Issues found: 검색 결과가 있지만 응답에 반영되지 않음
INFO:     14.225.71.149:45370 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '패밀리팩 3명 얼마야?'
Processed message: 패밀리팩 3명 얼마야?
Processing message: 패밀리팩 3명 얼마야? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['패밀리팩', '패밀리', 'family', '가족', '얼마', '가격', '비용', '요금', '얼마야']
New tour type detected: 패밀리. Clearing previous context.
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 패밀리팩 3명 얼마야?, Keywords found: []
=== PROMPT DEBUG ===
User message: 패밀리팩 3명 얼마야?
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1313
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "패밀리팩 3명 얼마야?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 안녕

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '베스트' 투어(패밀리팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "패밀리팩 3명 얼마야?"는 100% '베스트' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른 ...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어 3명 가격은 18만원 + $1,092입니다. 추가로 아동이 있을 경우, 아동 가격을 고려해야 합니다. 아동의 키에 따라서 성인 요금이 적용될 수 있으니, 아동의 키를...
Updated context with tour type: 패밀리
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:38168 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '키 150cm 2명 더 있어. '
Processed message: 키 150cm 2명 더 있어. 
Processing message: 키 150cm 2명 더 있어.  (conversation: 17)
Using cached tour results for: 
Determined intent: general
Keywords: ['있어', 'cm']
Using stored tour type from context: 패밀리
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 키 150cm 2명 더 있어. , Keywords found: []
=== PROMPT DEBUG ===
User message: 키 150cm 2명 더 있어. 
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1589
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어에 대해 말씀드리겠습니다. 현재 키 150cm인 아동 2명이 추가되었으니, 아동 가격을 계산해 드리겠습니다.

패밀리팩 투어의 아동 1인 가격은 성인 요금이 적용됩니다...
Updated context with tour type: 패밀리
Response was modified to remove forbidden content
Self-Validation Score: 58.3 (POOR)
INFO:     14.225.71.149:39268 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '안녕'
Processed message: 안녕
Processing message: 안녕 (conversation: 17)
Determined intent: general
Keywords: ['안녕']
Using stored tour type from context: 패밀리
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Updated context with tour type: 패밀리
Self-Validation Score: 41.7 (POOR)
Issues found: 검색 결과가 있지만 응답에 반영되지 않음
INFO:     14.225.71.149:41188 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '베스트팩 3명 얼마야'
Processed message: 베스트팩 3명 얼마야
Processing message: 베스트팩 3명 얼마야 (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['베스트팩', '베스트', 'best', '베스트투어', '얼마', '가격', '비용', '요금', '얼마야']
New tour type detected: 베스트. Clearing previous context.
Filtered tours by type '베스트': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 베스트팩 3명 얼마야, Keywords found: []
=== PROMPT DEBUG ===
User message: 베스트팩 3명 얼마야
Tours found: 1
Tour names: ['베스트팩']
Prompt length: 1209
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "베스트팩 3명 얼마야"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 안녕

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '패밀리' 투어(베스트팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "베스트팩 3명 얼마야"는 100% '패밀리' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른 모든...
=== END DEBUG ===
AI Response generated: 베스트팩 투어 3명 가격은 예약금 18만원 + 잔금 $1,160입니다. 총 비용을 계산하면, 예약금과 잔금을 합쳐서 18만원 + $1,160입니다. 추가로 아동이 있는 경우, 아동...
Updated context with tour type: 베스트
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:43662 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '패밀리팩 성인 2명은'
Processed message: 패밀리팩 성인 2명은
Processing message: 패밀리팩 성인 2명은 (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['패밀리팩', '패밀리', 'family', '가족', '성인', '명은']
New tour type detected: 패밀리. Clearing previous context.
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 패밀리팩 성인 2명은, Keywords found: []
=== PROMPT DEBUG ===
User message: 패밀리팩 성인 2명은
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1706
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어 성인 2명의 가격은 다음과 같습니다.

- 성인 2명: 12만원 + $932 

총액은 성인 2명의 가격으로, 원화와 달러를 포함하여 계산됩니다. 추가로 아동이 있을...
Updated context with tour type: 패밀리
Self-Validation Score: 58.3 (POOR)
Issues found: 가격 의도이지만 가격 관련 키워드가 없음
INFO:     14.225.71.149:33794 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 성인 5명 가격은?'
Processed message: 래프팅 성인 5명 가격은?
Processing message: 래프팅 성인 5명 가격은? (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '가격', '비용', '요금', '얼마', '성인', '가격은']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 성인 5명 가격은?, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 성인 5명 가격은?
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1102
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 성인 5명 가격은?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 패밀리팩 성인 2명은

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '패밀리' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 성인 5명 가격은?"는 100% '패밀리' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 ...
=== END DEBUG ===
AI Response generated: 래프팅 성인 5명 가격은 10만원입니다. 추가로 아동이 있는 경우, 아동 1인 가격은 예약금 1만원 + 잔금 $49입니다. 총액을 원하시면 아동 수를 알려주세요....
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:48884 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 4명 얼마야'
Processed message: 래프팅 4명 얼마야
Processing message: 래프팅 4명 얼마야 (conversation: 17)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금', '얼마야']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 4명 얼마야, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 4명 얼마야
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1093
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 4명 얼마야"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 성인 5명 가격은?

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 4명 얼마야"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- ...
=== END DEBUG ===
AI Response generated: 래프팅 투어 4명 가격은 8만원입니다. 추가로 아동이 있으면 아동 요금이 별도로 발생합니다. 도움이 필요하시면 말씀해 주세요!...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:60458 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 4명 얼마'
Processed message: 래프팅 4명 얼마
Processing message: 래프팅 4명 얼마 (conversation: 17)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 4명 얼마, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 4명 얼마
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1086
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 4명 얼마"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 4명 얼마야

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 4명 얼마"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른...
=== END DEBUG ===
AI Response generated: 래프팅 투어 4명 가격은 8만원입니다. 아동이 포함된 경우 아동 가격을 확인해야 합니다. 추가로 아동이 있다면 알려주세요!...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:47160 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 4명 얼마야'
Processed message: 래프팅 4명 얼마야
Processing message: 래프팅 4명 얼마야 (conversation: 17)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금', '얼마야']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: 5c41a752...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:60550 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '패밀리팩 2명 얼마야'
Processed message: 패밀리팩 2명 얼마야
Processing message: 패밀리팩 2명 얼마야 (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['패밀리팩', '패밀리', 'family', '가족', '얼마', '가격', '비용', '요금', '얼마야']
New tour type detected: 패밀리. Clearing previous context.
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 패밀리팩 2명 얼마야, Keywords found: []
=== PROMPT DEBUG ===
User message: 패밀리팩 2명 얼마야
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1318
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "패밀리팩 2명 얼마야"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 4명 얼마야

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(패밀리팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "패밀리팩 2명 얼마야"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- *...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어 2명 가격은 12만원 + $932입니다. 추가로 아동이 있을 경우 아동 가격도 알려주세요!...
Updated context with tour type: 패밀리
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:60560 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래픝이 4명 얼마니'
Processed message: 래픝이 4명 얼마니
Processing message: 래픝이 4명 얼마니 (conversation: 17)
Determined intent: price
Keywords: ['얼마', '가격', '비용', '요금', '래픝이', '얼마니']
Using previous search results for price inquiry
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래픝이 4명 얼마니, Keywords found: []
=== PROMPT DEBUG ===
User message: 래픝이 4명 얼마니
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1316
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래픝이 4명 얼마니"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 패밀리팩 2명 얼마야

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '패밀리' 투어(패밀리팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래픝이 4명 얼마니"는 100% '패밀리' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어 4명 가격은 24만원 + $1,242입니다. 추가로 아동이 포함되어 있는 경우 말씀해 주시면 아동 가격도 안내해 드리겠습니다....
Updated context with tour type: 패밀리
Self-Validation Score: 68.3 (WARNING)
INFO:     14.225.71.149:35938 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '아동 3명'
Processed message: 아동 3명
Processing message: 아동 3명 (conversation: 17)
Using cached tour results for: 
Determined intent: general
Keywords: ['아동']
Using stored tour type from context: 패밀리
Filtered tours by type '패밀리': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 아동 3명, Keywords found: []
=== PROMPT DEBUG ===
User message: 아동 3명
Tours found: 1
Tour names: ['패밀리팩']
Prompt length: 1687
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 패밀리팩 투어에 대해 문의주셨군요! 아동 3명의 가격을 안내해 드리겠습니다.

패밀리팩 투어는 성인 2명 기준으로 가격이 책정됩니다. 성인 2명의 가격은 **12만원 + $932*...
Updated context with tour type: 패밀리
Warning: Removing adult info from child-only question: 성인 \d+명:
Response was modified to remove forbidden content
Self-Validation Score: 58.3 (POOR)
INFO:     14.225.71.149:54360 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 3명 얼마냐'
Processed message: 래프팅 3명 얼마냐
Processing message: 래프팅 3명 얼마냐 (conversation: 17)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금', '얼마냐']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 3명 얼마냐, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 3명 얼마냐
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1084
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 3명 얼마냐"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 아동 3명

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '패밀리' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 3명 얼마냐"는 100% '패밀리' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른 모든...
=== END DEBUG ===
AI Response generated: 래프팅 투어 3명 가격은 6만원, 즉 $365입니다. 아동 3명이 포함된 경우, 아동 요금은 1인당 예약금 1만원과 잔금 $49이므로 아동 3명의 총액은 3만원 + $147입니다....
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:33816 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 4명 얼마냐'
Processed message: 래프팅 4명 얼마냐
Processing message: 래프팅 4명 얼마냐 (conversation: 17)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금', '얼마냐']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 4명 얼마냐, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 4명 얼마냐
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1089
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 4명 얼마냐"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 3명 얼마냐

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 4명 얼마냐"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 ...
=== END DEBUG ===
AI Response generated: 래프팅 투어 4명 가격은 8만원입니다. 추가로 아동이 있으시면 아동 가격을 알려주시면 총액을 계산해드리겠습니다....
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:47364 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 4명 얼마니'
Processed message: 래프팅 4명 얼마니
Processing message: 래프팅 4명 얼마니 (conversation: 18)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금', '얼마니']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 4명 얼마니, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 4명 얼마니
Tours found: 1
Tour names: ['래프팅']
Prompt length: 515
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 4명 얼마니"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요



사용자 질문: 래프팅 4명 얼마니

투어 정보:
🚌 **래프팅** (다낭)
📅 **반나절**
📝 관련정보: 요금 인당 기준
2인: 4만원/ $340
3인: 6만원 / $365
4인: 8만원 / $545
5인: 10만원 / $630
6인: 12만원/ $710
7인: 14만원  / $795
8인: 16만원/ $880
9인: 18만원  / $960
10인: 20만원 / $1045
아동가격 (1인 기준)
키 100cm 이상 ~ 140cm 미만: 예약금 1만원 + 잔금 $49
키 1...
=== END DEBUG ===
AI Response generated: 래프팅 4명의 가격은 8만원입니다. 추가로 아동이 있다면, 아동 요금도 함께 계산해드릴 수 있습니다. 아동의 키는 어떻게 되나요?...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:41442 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 4명 성인 가격은?'
Processed message: 래프팅 4명 성인 가격은?
Processing message: 래프팅 4명 성인 가격은? (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '가격', '비용', '요금', '얼마', '성인', '가격은']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 4명 성인 가격은?, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 4명 성인 가격은?
Tours found: 1
Tour names: ['래프팅']
Prompt length: 523
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 4명 성인 가격은?"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요



사용자 질문: 래프팅 4명 성인 가격은?

투어 정보:
🚌 **래프팅** (다낭)
📅 **반나절**
📝 관련정보: 요금 인당 기준
2인: 4만원/ $340
3인: 6만원 / $365
4인: 8만원 / $545
5인: 10만원 / $630
6인: 12만원/ $710
7인: 14만원  / $795
8인: 16만원/ $880
9인: 18만원  / $960
10인: 20만원 / $1045
아동가격 (1인 기준)
키 100cm 이상 ~ 140cm 미만: 예약금 1만원 + 잔금...
=== END DEBUG ===
AI Response generated: 래프팅 4명 성인 가격은 8만원입니다....
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:48660 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 3명 얼마'
Processed message: 래프팅 3명 얼마
Processing message: 래프팅 3명 얼마 (conversation: 10)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 3명 얼마, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 3명 얼마
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1239
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 3명 얼마"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 4명 성인 가격은?

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 3명 얼마"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **...
=== END DEBUG ===
AI Response generated: 래프팅 3명 가격은 6만원입니다....
Updated context with tour type: 래프팅
Self-Validation Score: 55.0 (POOR)
Issues found: 너무 많은 키워드가 추출됨, 응답이 너무 짧음
INFO:     14.225.71.149:55188 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '호이안 성인 2명'
Processed message: 호이안 성인 2명
Processing message: 호이안 성인 2명 (conversation: 10)
Using cached tour results for: 
Determined intent: general
Keywords: ['호이안', 'hoian', 'hoi an', '호이안시', '성인']
New tour type detected: 호이안. Clearing previous context.
Filtered tours by type '호이안': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 호이안 성인 2명, Keywords found: []
=== PROMPT DEBUG ===
User message: 호이안 성인 2명
Tours found: 1
Tour names: ['호이안']
Prompt length: 1720
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 호이안 투어 성인 2명 가격은 다음과 같습니다.

- 성인 2명: 예약금 4만원 + 잔금 $300 (약 40만원)
- 총액: 4만원 + 300달러 = 약 40만원

아동이 포함되면...
Updated context with tour type: 호이안
Self-Validation Score: 58.3 (POOR)
INFO:     14.225.71.149:50000 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 성인 2명은?'
Processed message: 래프팅 성인 2명은?
Processing message: 래프팅 성인 2명은? (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '성인', '명은']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 성인 2명은?, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 성인 2명은?
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1478
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 래프팅 투어 성인 2명의 가격은 4만원 또는 $340입니다. 아동이 없으므로 총액은 4만원 또는 $340입니다. 추가 질문이 있으시면 말씀해 주세요!...
Updated context with tour type: 래프팅
Self-Validation Score: 58.3 (POOR)
Issues found: 가격 의도이지만 가격 관련 키워드가 없음
INFO:     14.225.71.149:40326 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '베스트팩 3명 얼만'
Processed message: 베스트팩 3명 얼만
Processing message: 베스트팩 3명 얼만 (conversation: 10)
Determined intent: general
Keywords: ['베스트팩', '베스트', 'best', '베스트투어', '얼만']
New tour type detected: 베스트. Clearing previous context.
Filtered tours by type '베스트': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 베스트팩 3명 얼만, Keywords found: []
=== PROMPT DEBUG ===
User message: 베스트팩 3명 얼만
Tours found: 1
Tour names: ['베스트팩']
Prompt length: 1567
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 베스트팩 투어 3명 가격은 다음과 같습니다.

- 성인 3명: 예약금 18만원 + 잔금 $1,160

아동에 대한 정보가 없다면 성인 3명의 가격으로 계산할 수 있습니다. 추가로 ...
Updated context with tour type: 베스트
Self-Validation Score: 58.3 (POOR)
INFO:     14.225.71.149:51958 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 3명은?'
Processed message: 래프팅 3명은?
Processing message: 래프팅 3명은? (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '명은']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 3명은?, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 3명은?
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1539
Prompt preview: 당신은 똑똑한 여행 상담사입니다.

**문맥 추적 (매우 중요):**
- 이전 대화에서 어떤 투어를 논의했는지 반드시 확인하세요
- 주어가 생략된 질문("아이가격은?", "호텔은?")이면 바로 직전 대화의 투어를 계속 사용하세요
- 투어를 절대 바꾸지 마세요 (라이트팩 대화 중이면 계속 라이트팩만)

**상황 파악:**
- "2명"은 기본적으로 "성인 2명"으로 인식하세요
- 애매한 표현은 문맥으로 추론하세요 ("3명 아이2명" → "성인3명 + 아동2명 총5명")
- 투어명이 불분명하면 유사한 투어를 제안하세요 ("혹시 XX투어를 말씀하시는 건가요?")

**완전한 답변:**
- 가격 계산 시 성인 가격을 먼저 명시하고, 아동이 있으면 추가로 계산하세요
- 성인 X명: 구체적 가격 표시
- 아동 X명: 구체적 가격 표시 (있는 경우)
- 총액: 성인 + 아동 = 전체 금액
- 이미 제공된 정보는 다시 묻지 말고, 부족한 정보만 구체적으로 질문하세요

**정보 제한:**
- 데이터베...
=== END DEBUG ===
AI Response generated: 래프팅 투어 3명에 대한 가격은 다음과 같습니다.

- 성인 3명: 6만원 / $365

아동에 대한 정보가 없으므로, 아동이 있는 경우 그에 대한 추가 정보를 알려주시면 추가 계...
Updated context with tour type: 래프팅
Self-Validation Score: 58.3 (POOR)
Issues found: 가격 의도이지만 가격 관련 키워드가 없음
INFO:     14.225.71.149:44650 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '라이트팩 4명 얼마니'
Processed message: 라이트팩 4명 얼마니
Processing message: 라이트팩 4명 얼마니 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['라이트팩', '라이트', 'light', '라이트투어', '얼마', '가격', '비용', '요금', '얼마니']
New tour type detected: 라이트. Clearing previous context.
Filtered tours by type '라이트': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 라이트팩 4명 얼마니, Keywords found: []
=== PROMPT DEBUG ===
User message: 라이트팩 4명 얼마니
Tours found: 1
Tour names: ['라이트팩']
Prompt length: 1325
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "라이트팩 4명 얼마니"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 3명은?

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(라이트팩)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "라이트팩 4명 얼마니"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫...
=== END DEBUG ===
AI Response generated: 라이트팩 투어 4명 가격은 예약금 24만원, 잔금 $1,035입니다. 추가로 아동이 있으면 아동 요금도 말씀해 주세요....
Updated context with tour type: 라이트
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:57254 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 2명 얼마'
Processed message: 래프팅 2명 얼마
Processing message: 래프팅 2명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 2명 얼마, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 2명 얼마
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1087
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 2명 얼마"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 라이트팩 4명 얼마니

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '라이트' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 2명 얼마"는 100% '라이트' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다...
=== END DEBUG ===
AI Response generated: 래프팅 투어 2명 가격은 8만원입니다. 아동이 포함되어 있으면 추가로 알려주세요!...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:56168 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 5명 얼마'
Processed message: 래프팅 5명 얼마
Processing message: 래프팅 5명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 래프팅 5명 얼마, Keywords found: []
=== PROMPT DEBUG ===
User message: 래프팅 5명 얼마
Tours found: 1
Tour names: ['래프팅']
Prompt length: 1085
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "래프팅 5명 얼마"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 2명 얼마

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(래프팅)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "래프팅 5명 얼마"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른 ...
=== END DEBUG ===
AI Response generated: 래프팅 투어 5명 가격은 10만원입니다. 추가로 아동이 포함된 경우, 아동 1인의 가격은 키에 따라 다르니 확인 후 말씀해 주세요. 총액을 계산하려면 아동 인원도 알려주시면 됩니다...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:42862 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '호이안 2명 얼마'
Processed message: 호이안 2명 얼마
Processing message: 호이안 2명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['호이안', 'hoian', 'hoi an', '호이안시', '얼마', '가격', '비용', '요금']
New tour type detected: 호이안. Clearing previous context.
Filtered tours by type '호이안': 1 tours found
Found hotels: 0, tours: 1
Info request check: False, hotels: 0, tours: 1
Message: 호이안 2명 얼마, Keywords found: []
=== PROMPT DEBUG ===
User message: 호이안 2명 얼마
Tours found: 1
Tour names: ['호이안']
Prompt length: 1147
Prompt preview: 당신은 이여행사 직원입니다. 각 투어상품, 호텔, 기타 서비스를 헷갈리지 않게 정확히 답변하세요.

고객이 "호이안 2명 얼마"라고 가격을 문의했습니다.

**답변 규칙:**
- 정확한 가격 정보만 제공하세요 (투어 설명 금지)
- 이전 대화에서 논의된 투어가 있으면 그 투어의 가격만 답변
- 투어명이 없으면 "어떤 투어의 가격을 문의하시나요?"라고 물어보세요
- 데이터베이스에 있는 가격 정보만 제공하세요


**📋 이전 대화 내용**: 래프팅 5명 얼마

🚨🚨🚨 **절대 엄수 - 이전 대화 투어 유지!** 🚨🚨🚨
**🚨🚨🚨 절대 중요: 투어 전환 금지! 🚨🚨🚨**
**🎯 현재 고객은 '래프팅' 투어(호이안)에 대해 연속 문의 중입니다.**

**💀 절대 금지: 다른 투어 정보 사용 금지! 💀**
- 현재 질문 "호이안 2명 얼마"는 100% '래프팅' 투어에 관한 것입니다!
- **🚫 래프팅 투어 정보 절대 사용 금지!** (성인 2명 $340, 아동 $49 등)
- **🚫 다른 ...
=== END DEBUG ===
AI Response generated: 호이안 투어 2명 가격은 예약금 4만원과 잔금 $300입니다. 총액은 4만원 + $300입니다. 추가로 아동이 있으신 경우 알려주시면 아동 가격도 안내해드리겠습니다....
Updated context with tour type: 호이안
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:54170 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 2명 얼마'
Processed message: 래프팅 2명 얼마
Processing message: 래프팅 2명 얼마 (conversation: 10)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ee1d56e9...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:42232 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 2명 얼마'
Processed message: 래프팅 2명 얼마
Processing message: 래프팅 2명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ee1d56e9...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:40032 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 2명 얼마'
Processed message: 래프팅 2명 얼마
Processing message: 래프팅 2명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ee1d56e9...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:55372 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 2명 얼마'
Processed message: 래프팅 2명 얼마
Processing message: 래프팅 2명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ee1d56e9...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:60870 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 3명 얼마'
Processed message: 래프팅 3명 얼마
Processing message: 래프팅 3명 얼마 (conversation: 10)
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ce8df1f8...
Updated context with tour type: 래프팅
Self-Validation Score: 55.0 (POOR)
Issues found: 너무 많은 키워드가 추출됨, 응답이 너무 짧음
INFO:     14.225.71.149:42794 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 2명 얼마'
Processed message: 래프팅 2명 얼마
Processing message: 래프팅 2명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ee1d56e9...
Updated context with tour type: 래프팅
Self-Validation Score: 61.7 (WARNING)
Issues found: 너무 많은 키워드가 추출됨
INFO:     14.225.71.149:33802 - "POST /chat HTTP/1.1" 200 OK
Raw message received: '래프팅 3명 얼마'
Processed message: 래프팅 3명 얼마
Processing message: 래프팅 3명 얼마 (conversation: 10)
Using cached tour results for: 
Determined intent: price
Keywords: ['래프팅', 'rafting', '급류타기', '래프팅투어', '얼마', '가격', '비용', '요금']
New tour type detected: 래프팅. Clearing previous context.
Using cached hotel results for: 래프팅, rafting
Using cached tour results for: 래프팅, rafting
Filtered tours by type '래프팅': 1 tours found
Found hotels: 0, tours: 1
Using cached response for key: ce8df1f8...
Updated context with tour type: 래프팅
Self-Validation Score: 55.0 (POOR)
Issues found: 너무 많은 키워드가 추출됨, 응답이 너무 짧음
INFO:     14.225.71.149:36028 - "POST /chat HTTP/1.1" 200 OK
